<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="reporting-service">
  <template>

  <!-- this below ajax is used to call the function that fetches the total number of enquiry done with repsect to academic year and group by grade wise -->
      <iron-ajax
        method="post"
        id="getcountyearwiseajax"
        url="{{getcountyearwiseurl}}"
        params="{{getcountyearwiseparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getcountyearwiseResponse"
        debounce-duration="300"
        ></iron-ajax>

      <!-- this below ajax calls the function that fetch the count of enquiry came on the current month -->
        <iron-ajax
        method="post"
        id="getcurrmonthcountajax"
        url="{{getcurrmonthcounturl}}"
        params="{{getcurrmonthcountparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getcurrmonthcountResponse"
        debounce-duration="300"
        ></iron-ajax>

        <!-- this below ajax calls the function that fetch the count of enquiry came on the current day -->
        <iron-ajax
        method="post"
        id="getcurrdaycountajax"
        url="{{getcurrdaycounturl}}"
        params="{{getcurrdaycountparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getcurrdaycountResponse"
        debounce-duration="300"
        ></iron-ajax>

        <!-- this below ajax is used to the function that can fetch the count of the enquiries those who bought prospectus -->
         <iron-ajax
        method="post"
        id="getprospectuscountajax"
        url="{{getprospectuscounturl}}"
        params="{{getprospectuscountparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getprospectuscountResponse"
        debounce-duration="300"
        ></iron-ajax>
  </template>
  <script>
  (function() {
    'use strict';
      var academic_year;
      var academicarr=[];
      var currmontharr=[];
      var currdayarr=[];
      var dat=new Date();
    Polymer({
      is: 'reporting-service',

         masterReportService:function(){
          
          if((dat.getMonth()+1)>=7){

            academic_year='AY-'+(dat.getFullYear()+1)+'-'+(dat.getFullYear()+2);
          }
          else if((dat.getMonth()+1)<=6){
                academic_year='AY-'+(dat.getFullYear())+'-'+(dat.getFullYear()+1);
          }
          //alert(academic_year);
        this.getcountyearwiseurl="http://localhost:8086/getcountyearwise";
        var obj={"schoolid":"","academicyr":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.academicyr=academic_year;
        this.getcountyearwiseparam=obj;
        this.$.getcountyearwiseajax.generateRequest();
      },
      getcountyearwiseResponse:function(e){
          academicarr=e.detail.response.returval;

          this.getcurrmonthcounturl="http://localhost:8086/getcurrmonthcount";
        var obj={"schoolid":"","currmonth":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.currmonth='%/'+(dat.getMonth()+1)+'/'+dat.getFullYear();
        this.getcurrmonthcountparam=obj;
        //alert(JSON.stringify(obj));
        this.$.getcurrmonthcountajax.generateRequest();

      },
      getcurrmonthcountResponse:function(e){
          currmontharr=e.detail.response.returnval;

           this.getcurrdaycounturl="http://localhost:8086/getcurrdaycount";
        var obj={"schoolid":"","todate":""};
        obj.schoolid=localStorage.getItem("schoolid");
        obj.todate=dat.getDate()+'/'+(dat.getMonth()+1)+'/'+dat.getFullYear();
        this.getcurrdaycountparam=obj;
        //alert(JSON.stringify(obj));
        this.$.getcurrdaycountajax.generateRequest();
      },
      getcurrdaycountResponse:function(e){
          //alert(JSON.stringify(e.detail.response.returnval));
          currdayarr=e.detail.response.returnval;


      }

      
    });
  })();
  </script>
</dom-module>
