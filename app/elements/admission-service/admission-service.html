

<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="admission-service">
  <template>
   <!-- It would fetch the enquiry no's -->
     <iron-ajax
        method="post"
        id="searchenquiryajax"
        url="{{searchenquiryurl}}"
        params="{{searchenquiryparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="searchenquiryResponse"
        debounce-duration="300"
        >
         <!-- It would fetch the enquiry no's -->
     <iron-ajax
        method="post"
        id="searchexistingadmissionajax"
        url="{{searchexistingadmissionurl}}"
        params="{{searchexistingadmissionparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="searchexistingadmissionResponse"
        debounce-duration="300"
        >
    <!-- this ajax is to fetch the available classes with repect to the school -->
   <iron-ajax
        method="post"
        id="getclassesajax"
        url="{{getclassesurl}}"
        params="{{getclassesparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getclassesResponse"
        debounce-duration="300"
        >
    <!-- Component will fetch the selected enquiry info -->
   <iron-ajax
        method="post"
        id="fetchenquiryinfoajax"
        url="{{fetchenquiryinfourl}}"
        params="{{fetchenquiryinfoparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchenquiryinfoResponse"
        debounce-duration="300"
        >
         <!-- Component will fetch the selected enquiry info -->
   <iron-ajax
        method="post"
        id="fetchexistingadmissioninfoajax"
        url="{{fetchexistingadmissioninfourl}}"
        params="{{fetchexistingadmissioninfoparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchexistingadmissioninfoResponse"
        debounce-duration="300"
        >
         <!-- Component will fetch the selected enquiry info -->
   <iron-ajax
        method="post"
        id="fetchexistingadmissionstudinfoajax"
        url="{{fetchexistingadmissionstudinfourl}}"
        params="{{fetchexistingadmissionstudinfoparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchexistingadmissionstudinfoResponse"
        debounce-duration="300"
        >
         <!-- Component will fetch the selected enquiry info -->
   <iron-ajax
        method="post"
        id="fetchexistingadmissioncoinfoajax"
        url="{{fetchexistingadmissioncoinfourl}}"
        params="{{fetchexistingadmissioncoinfoparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchexistingadmissioncoinfoResponse"
        debounce-duration="300"
        >
         <!-- Component will fetch the selected enquiry info -->
   <iron-ajax
        method="post"
        id="fetchexistingadmissionphysicinfoajax"
        url="{{fetchexistingadmissionphysicinfourl}}"
        params="{{fetchexistingadmissionphysicinfoparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchexistingadmissionphysicinfoResponse"
        debounce-duration="300"
        >
         <!-- Component will fetch the selected enquiry info -->
   <iron-ajax
        method="post"
        id="fetchexistingadmissionhistoryinfoajax"
        url="{{fetchexistingadmissionhistoryinfourl}}"
        params="{{fetchexistingadmissionhistoryinfoparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchexistingadmissionhistoryinfoResponse"
        debounce-duration="300"
        >
        <!-- Component will insert Admission info-->
   <iron-ajax
        method="post"
        id="insertadmissionajax"
        url="{{insertadmissionurl}}"
        params="{{insertadmissionparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="insertadmissionResponse"
        debounce-duration="300"
        >
        <!-- Component will insert student info-->
   <iron-ajax
        method="post"
        id="insertstudentajax"
        url="{{insertstudenturl}}"
        params="{{insertstudentparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="insertstudentResponse"
        debounce-duration="300"
        >
       <!-- Component will insert school history -->
   <iron-ajax
        method="post"
        id="insertstudenthistoryajax"
        url="{{insertstudenthistoryurl}}"
        params="{{insertstudenthistoryparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="insertstudenthistoryResponse"
        debounce-duration="300"
        >
        <!-- Component will insert student disability info -->
   <iron-ajax
        method="post"
        id="insertdisabilityinfoajax"
        url="{{insertdisabilityinfourl}}"
        params="{{insertdisabilityinfoparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="insertdisabilityinfoResponse"
        debounce-duration="300"
        >
        <!-- Component will insert student co curricular info-->
   <iron-ajax
        method="post"
        id="insertcocurricularinfoajax"
        url="{{insertcocurricularinfourl}}"
        params="{{insertcocurricularinfoparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="insertcocurricularinfoResponse"
        debounce-duration="300"
        >


            <!-- Component will insert student co curricular info-->
   <iron-ajax
        method="post"
        id="searchfeeenquiryajax"
        url="{{searchfeeenquiryurl}}"
        params="{{searchfeeenquiryparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="searchfeeenquiryResponse"
        debounce-duration="300"
        >


            <!-- Component will insert student co curricular info-->
   <iron-ajax
        method="post"
        id="fetchfeeajax"
        url="{{fetchfeeurl}}"
        params="{{fetchfeeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchfeeResponse"
        debounce-duration="300"
        >
        

            <!-- Component will insert student co curricular info-->
   <iron-ajax
        method="post"
        id="searchadmnenquiryajax"
        url="{{searchadmnenquiryurl}}"
        params="{{searchadmnenquiryparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="searchadmnenquiryResponse"
        debounce-duration="300"
        >
                <!-- Component will insert student co curricular info-->
   <iron-ajax
        method="post"
        id="searchadmissionajax"
        url="{{searchadmissionurl}}"
        params="{{searchadmissionparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="searchadmissionResponse"
        debounce-duration="300"
        >
        <!-- Component will fetch the fee component-->
   <iron-ajax
        method="post"
        id="fetchfeesajax"
        url="{{fetchfeesurl}}"
        params="{{fetchfeesparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchfeesResponse"
        debounce-duration="300"
        >
        <!-- Component will fetch the fee split up component-->
   <iron-ajax
        method="post"
        id="fetchfeesplitupajax"
        url="{{fetchfeesplitupurl}}"
        params="{{fetchfeesplitupparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchfeesplitupResponse"
        debounce-duration="300"
        >
        <!-- Component will fetch the no of installment-->
   <iron-ajax
        method="post"
        id="fetchnoofinstallmentajax"
        url="{{fetchnoofinstallmenturl}}"
        params="{{fetchnoofinstallmentparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchnoofinstallmentResponse"
        debounce-duration="300"
        >
    <!-- this below ajax gives the total number of enquiry appeared categorized based on the grade -->
    <iron-ajax
        method="post"
        id="getadmissioncountajax"
        url="{{getadmissioncounturl}}"
        params="{{getadmissioncountparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getadmissioncountResponse"
        debounce-duration="300"
        >

        <!-- this below fetch the admission test info-->
    <iron-ajax
        method="post"
        id="fetchadmissiontestinfoajax"
        url="{{fetchadmissiontestinfourl}}"
        params="{{fetchadmissiontestinfoparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="fetchadmissiontestinfoResponse"
        debounce-duration="300"
        >


 <iron-ajax
        method="post"
        id="updateteststatusajax"
        url="{{updateteststatusurl}}"
        params="{{updateteststatusparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="updateteststatusResponse"
        debounce-duration="300"
        >

        <iron-ajax
        method="post"
        id="studentfulldetailsajax"
        url="{{studentfulldetailsurl}}"
        params="{{studentfulldetailsparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="studentfulldetailsResponse"
        debounce-duration="300"
        >
        <iron-ajax
        method="post"
        id="studentcocurricularajax"
        url="{{studentcocurricularurl}}"
        params="{{studentcocurricularparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="studentcocurricularResponse"
        debounce-duration="300"
        >
         <iron-ajax
        method="post"
        id="studentphysicalajax"
        url="{{studentphysicalurl}}"
        params="{{studentphysicalparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="studentphysicalResponse"
        debounce-duration="300"
        >
        <iron-ajax
        method="post"
        id="studenthistoryajax"
        url="{{studenthistoryurl}}"
        params="{{studenthistoryparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="studenthistoryResponse"

        debounce-duration="300"
        >
        <iron-ajax
        method="post"
        id="searchfeeadmissionajax"
        url="{{searchfeeadmissionurl}}"
        params="{{searchfeeadmissionparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="searchfeeadmissionResponse"
        debounce-duration="300"
        >
        <iron-ajax
        method="post"
        id="searchfeeadmissioninfoajax"
        url="{{searchfeeadmissioninfourl}}"
        params="{{searchfeeadmissioninfoparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="searchfeeadmissioninfoResponse"
        debounce-duration="300"
        >
  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'admission-service',
      callSearchenquiryService:function(enquiryno){        
        this.searchenquiryurl=sessionStorage.getItem("addrinfo")+"/searchenquiry";
        localStorage.setItem("curr_sess_insertflag",1);
        var obj={"enquiryno":"","schoolid":""};
        obj.enquiryno=enquiryno;
        this.enquiryno=enquiryno;
        obj.schoolid=localStorage.getItem("schoolid");
        this.searchenquiryparam=obj;
        this.$.searchenquiryajax.generateRequest();
      },
      searchenquiryResponse:function(e){
        // alert(JSON.stringify(e.detail.response.returnval));
        if(e.detail.response.returnval=='no enquiry'||e.detail.response.returnval=='exist'){
            this.callSearchexistingadmissionService();        
        }
        else{
            document.querySelector('admission-form').enquiryarr=e.detail.response.returnval;
            document.querySelector('admission-approval-card').enquiryarr=e.detail.response.returnval;
            document.querySelector('fees-card').enquiryarr=e.detail.response.returnval;
        }
      },
      callSearchexistingadmissionService:function(){  
        this.searchexistingadmissionurl=sessionStorage.getItem("addrinfo")+"/searchexistingadmission";
        localStorage.setItem("curr_sess_insertflag",2);
        var obj={"admissionno":"","schoolid":""};
        obj.admissionno=this.enquiryno;
        obj.schoolid=localStorage.getItem("schoolid");
        this.searchexistingadmissionparam=obj;
        this.$.searchexistingadmissionajax.generateRequest();
      },
      searchexistingadmissionResponse:function(e){
        var admnarr=e.detail.response.returnval;
        var arr=[];
        var obj={"enquiry_no":"","enquiry_name":""};
        // alert(admnarr[0].enquiry_no);
        localStorage.setItem("curr_sess_admnenquiryno",admnarr[0].enquiry_no);
        obj.enquiry_no=admnarr[0].admission_no; 
        obj.enquiry_name=admnarr[0].student_name;  
        arr.push(obj); 
        document.querySelector('admission-form').enquiryarr=arr;
        // document.querySelector('fees-card').enquiryarr=arr;
      },
      callFetchenquiryinfoService:function(){
        this.fetchenquiryinfourl=sessionStorage.getItem("addrinfo")+"/fetchenquiryinfo";
        var obj={"enquiryno":"","schoolid":""}
        obj.enquiryno=localStorage.getItem("curr_sess_enquiryno");
        obj.schoolid=localStorage.getItem("schoolid");
        this.fetchenquiryinfoparam=obj;
        this.$.fetchenquiryinfoajax.generateRequest();
      },
      fetchenquiryinfoResponse:function(e){
        var arr=e.detail.response.returnval;
        // alert(JSON.stringify(arr));
        // alert(document.querySelector('admission-form').schoolname);
        if(arr=='no rows'){
            this.fetchexistingadmissioninfoService();
            this.fetchexistingadmissionstudinfoService();
            this.fetchexistingadmissionhistoryinfoService();
            this.fetchexistingadmissionphysicinfoService();
            this.fetchexistingadmissioncoinfoService();
        }
        else
        {
        document.querySelector('admission-form').schoolname=localStorage.getItem("schoolname");
        document.querySelector('admission-form').applicationno=arr[0].prospectus_no;
        document.querySelector('admission-form').enquiredyear=arr[0].academic_year;
        document.querySelector('admission-form').firstname=arr[0].first_name;
        document.querySelector('admission-form').middlename=arr[0].middle_name;
        document.querySelector('admission-form').lastname=arr[0].last_name;
        document.querySelector('admission-form').gradeselection=arr[0].class;
        document.querySelector('admission-form').FnSetSecLanguage(arr[0].second_language);
        if(arr[0].class=="Nursery"||arr[0].class=="Junior KG"||arr[0].class=="Senior KG"||arr[0].class=="Grade-1"||arr[0].class=="Grade-2"||arr[0].class=="Grade-3"||arr[0].class=="Grade-4"){
            document.querySelector('admission-form').FnHideThirdLanguage(true);
        }
        else{
        document.querySelector('admission-form').FnHideThirdLanguage(false);
        document.querySelector('admission-form').FnSetThirdLanguage(arr[0].third_language);
        }
        document.querySelector('dateofbirth-datepicker').FnSetDate(arr[0].dob);
        document.querySelector('admission-form').dob=arr[0].dob;
        document.querySelector('admission-form').FnFindAge(arr[0].dob);
        document.querySelector('admission-form').FnSetGender(arr[0].gender);

        document.querySelector('admission-form').flatno=arr[0].flat_no;
        document.querySelector('admission-form').bulidingname=arr[0].address1;
        document.querySelector('admission-form').street=arr[0].address2;
        document.querySelector('admission-form').town=arr[0].address3;
        document.querySelector('admission-form').city=arr[0].city;
        document.querySelector('admission-form').state=arr[0].state;
        document.querySelector('admission-form').pincode=arr[0].pincode;

        document.querySelector('admission-form').mothertongue=arr[0].mother_tongue;

        document.querySelector('admission-form').siblingname=arr[0].sibiling_name;
        document.querySelector('admission-form').siblingclass=arr[0].sibling_detail;

        document.querySelector('admission-form').prevschoolname=arr[0].old_school;

        document.querySelector('admission-form').fathername=arr[0].father_name;
        document.querySelector('admission-form').mothername=arr[0].mother_name;
        document.querySelector('admission-form').fatheroccupation=arr[0].father_profession;
        document.querySelector('admission-form').motheroccupation=arr[0].mother_profession;
        document.querySelector('admission-form').fatherqualification=arr[0].father_qualification;
        document.querySelector('admission-form').motherqualification=arr[0].mother_qualification;
        document.querySelector('admission-form').fathermobile=arr[0].father_mob;
        document.querySelector('admission-form').mothermobile=arr[0].mother_mob;
        document.querySelector('admission-form').fatheremail=arr[0].father_email;
        document.querySelector('admission-form').motheremail=arr[0].mother_email;
        document.querySelector('admission-form').fatherincome=arr[0].father_income;
        document.querySelector('admission-form').motherincome=arr[0].mother_income;
        document.querySelector('admission-form').FnSetTransport(arr[0].transport_requirment);
        document.querySelector('admission-form').FnSetCanteen(arr[0].canteen_requirment);
        }
      },
      fetchexistingadmissioninfoService:function(){
        this.fetchexistingadmissioninfourl=sessionStorage.getItem("addrinfo")+"/fetchexistingadmissioninfo";
        var obj={"admissionno":"","schoolid":""}
        // alert(localStorage.getItem("curr_sess_enquiryno"));
        obj.admissionno=localStorage.getItem("curr_sess_enquiryno");
        obj.schoolid=localStorage.getItem("schoolid");
        this.fetchexistingadmissioninfoparam=obj;
        this.$.fetchexistingadmissioninfoajax.generateRequest();
      },
      fetchexistingadmissioninfoResponse:function(e){
        // alert(JSON.stringify(e.detail.response.returnval));
        var arr=e.detail.response.returnval;
        if(arr=='no rows'){
            // alert('No match found!');
        }
        else
        {
        document.querySelector('admission-form').enqenrlabel="Enquiry Number";
        document.querySelector('admission-form').enqenrno=arr[0].enquiry_no;
        // localStorage.setItem("curr_sess_enquiryno",arr[0].enquiry_no);    
        document.querySelector('admission-form').schoolname=localStorage.getItem("schoolname");
        document.querySelector('admission-form').applicationno=arr[0].prospect_application_no;
        document.querySelector('admission-form').enquiredyear=arr[0].academic_year;
        document.querySelector('admission-form').selectedadmnyear=arr[0].admission_year;
        document.querySelector('admission-form').FnSetAdmnYear(arr[0].admission_year);
        document.querySelector('admission-form').firstname=arr[0].first_name;
        document.querySelector('admission-form').middlename=arr[0].middle_name;
        document.querySelector('admission-form').lastname=arr[0].last_name;
        document.querySelector('admission-form').gradeselection=arr[0].class_for_admission;
       
        document.querySelector('admission-form').dob=arr[0].dob;
        document.querySelector('admission-form').FnFindAge(arr[0].dob);
        document.querySelector('admission-form').FnSetGender(arr[0].gender);
        
        document.querySelector('admission-form').fathername=arr[0].father_name;
        document.querySelector('admission-form').mothername=arr[0].mother_name;
        document.querySelector('admission-form').FnSetTransport(arr[0].transport_availed);
        document.querySelector('admission-form').FnSetCanteen(arr[0].canteen_availed);
        document.querySelector('admission-form').FnSetDisabled(arr[0].disabled_student);
        document.querySelector('admission-form').FnSetAcheivement(arr[0].academic_acheivement);
        // document.querySelector('admission-form').FnShowDisable(arr[0].disabled_student);
        // document.querySelector('admission-form').FnShowAcheivement(arr[0].academic_acheivement);        

        // document.querySelector('admission-form').mothername=arr[0].mother_name;


        }
      },
      fetchexistingadmissionstudinfoService:function(){
        this.fetchexistingadmissionstudinfourl=sessionStorage.getItem("addrinfo")+"/fetchexistingadmissionstudinfo";
        var obj={"admissionno":"","schoolid":""}
        obj.admissionno=localStorage.getItem("curr_sess_admnenquiryno");
        obj.schoolid=localStorage.getItem("schoolid");
        this.fetchexistingadmissionstudinfoparam=obj;
        this.$.fetchexistingadmissionstudinfoajax.generateRequest();
      },
      fetchexistingadmissionstudinfoResponse:function(e){
        // alert(JSON.stringify(e.detail.response.returnval));
        var arr=e.detail.response.returnval;
        if(arr=='no rows'){
            // alert('No match found!');
        }
        else
        {
        document.querySelector('admission-form').FnSetSecLanguage(arr[0].second_language);
        if(arr[0].class_for_admission=='Grade-5'||arr[0].class_for_admission=='Grade-6'||arr[0].class_for_admission=='Grade-7'||arr[0].class_for_admission=='Grade-8'||arr[0].class_for_admission=='Grade-9'||arr[0].class_for_admission=='Grade-10'){
            document.querySelector('admission-form').FnHideThirdLanguage(false);
            document.querySelector('admission-form').FnSetThirdLanguage(arr[0].third_language);
        }
        else{
            document.querySelector('admission-form').FnHideThirdLanguage(true);
        }
        document.querySelector('dateofbirth-datepicker').FnSetDate(arr[0].dob);
        document.querySelector('admission-form').dob=arr[0].dob;
        document.querySelector('admission-form').FnFindAge(arr[0].dob);
        document.querySelector('admission-form').FnSetGender(arr[0].gender);

        document.querySelector('admission-form').flatno=arr[0].flat_no;
        document.querySelector('admission-form').bulidingname=arr[0].building_name;
        document.querySelector('admission-form').street=arr[0].street;
        document.querySelector('admission-form').town=arr[0].town;
        document.querySelector('admission-form').city=arr[0].city;
        document.querySelector('admission-form').state=arr[0].state;
        document.querySelector('admission-form').pincode=arr[0].pincode;
        document.querySelector('admission-form').height=arr[0].height;
        document.querySelector('admission-form').weight=arr[0].weight;
        document.querySelector('admission-form').selectedbg=arr[0].blood_group;
        document.querySelector('admission-form').FnSetBg(arr[0].blood_group);
        document.querySelector('admission-form').nationality=arr[0].nationality;
        document.querySelector('admission-form').mothertongue=arr[0].mother_toungue;

        document.querySelector('admission-form').siblingname=arr[0].sibling_name;
        document.querySelector('admission-form').siblingclass=arr[0].sibling_class;

        document.querySelector('admission-form').fathername=arr[0].father_name;
        document.querySelector('admission-form').mothername=arr[0].mother_name;
        document.querySelector('admission-form').fatherqualification=arr[0].father_profession;
        document.querySelector('admission-form').motherqualification=arr[0].mother_profession;
        document.querySelector('admission-form').fatheroccupation=arr[0].father_occupation;
        document.querySelector('admission-form').motheroccupation=arr[0].mother_occupation;
        document.querySelector('admission-form').fatherincome=arr[0].father_income;
        document.querySelector('admission-form').motherincome=arr[0].mother_income;
        document.querySelector('admission-form').fathertelno=arr[0].father_tel;
        document.querySelector('admission-form').mothertelno=arr[0].mother_tel;
        document.querySelector('admission-form').fathermobile=arr[0].father_mobile;
        document.querySelector('admission-form').mothermobile=arr[0].mother_mobile;
        document.querySelector('admission-form').fatheremail=arr[0].father_email;
        document.querySelector('admission-form').motheremail=arr[0].mother_email;

        document.querySelector('admission-form').pflatno=arr[0].permanent_pflatno;
        document.querySelector('admission-form').pbuildingname=arr[0].permanent_pbuildingname;
        document.querySelector('admission-form').pstreet=arr[0].permanent_pstreet;
        document.querySelector('admission-form').ptown=arr[0].permanent_town;
        document.querySelector('admission-form').pdistrict=arr[0].permanent_district;
        document.querySelector('admission-form').pstate=arr[0].permanent_state;
        document.querySelector('admission-form').ppincode=arr[0].permanent_pincode;

        document.querySelector('admission-form').guardianname1=arr[0].guardian_name;
        document.querySelector('admission-form').relationship1=arr[0].guardian_relationship;
        document.querySelector('admission-form').gflatno=arr[0].guard_flatno;
        document.querySelector('admission-form').gbuildingname=arr[0].guard_building;
        document.querySelector('admission-form').gstreet=arr[0].guard_street;
        document.querySelector('admission-form').gtown=arr[0].guard_town;
        document.querySelector('admission-form').gcity=arr[0].guard_city;
        document.querySelector('admission-form').gstate=arr[0].guard_state;
        document.querySelector('admission-form').gpincode=arr[0].guard_pincode;

        document.querySelector('admission-form').gresidentialcontact=arr[0].guard_res_contact;
        document.querySelector('admission-form').gofficecontact=arr[0].guard_office_contact;
        document.querySelector('admission-form').gmobileno=arr[0].guard_mobile_no;
        document.querySelector('admission-form').gfax=arr[0].guard_fax;

        document.querySelector('admission-form').FnSetCaste(arr[0].caste);
        document.querySelector('admission-form').relegion=arr[0].religion;
               
        }
      },
       fetchexistingadmissioncoinfoService:function(){
        this.fetchexistingadmissioncoinfourl=sessionStorage.getItem("addrinfo")+"/fetchexistingadmissioncoinfo";
        var obj={"admissionno":"","schoolid":""}
        obj.admissionno=localStorage.getItem("curr_sess_admnenquiryno");
        obj.schoolid=localStorage.getItem("schoolid");
        this.fetchexistingadmissioncoinfoparam=obj;
        this.$.fetchexistingadmissioncoinfoajax.generateRequest();
      },
      fetchexistingadmissioncoinfoResponse:function(e){
        // alert(JSON.stringify(e.detail.response.returnval));
        var arr=e.detail.response.returnval;
        if(arr=='no rows'){
            // alert('No match found!');
        }
        else
        {
        document.querySelector('admission-form').field1=arr[0].field1;
        document.querySelector('admission-form').year1=arr[0].year1;    
        document.querySelector('admission-form').event1=arr[0].event1;
        document.querySelector('admission-form').prizedetail1=arr[0].prize1;
        document.querySelector('admission-form').field2=arr[0].field2;
        document.querySelector('admission-form').year2=arr[0].year2;    
        document.querySelector('admission-form').event2=arr[0].event2;
        document.querySelector('admission-form').prizedetail2=arr[0].prize2;
        document.querySelector('admission-form').field3=arr[0].field3;
        document.querySelector('admission-form').year3=arr[0].year3;    
        document.querySelector('admission-form').event3=arr[0].event3;
        document.querySelector('admission-form').prizedetail3=arr[0].prize3;      
        }
      },
       fetchexistingadmissionphysicinfoService:function(){
        this.fetchexistingadmissionphysicinfourl=sessionStorage.getItem("addrinfo")+"/fetchexistingadmissionphysicinfo";
        var obj={"admissionno":"","schoolid":""}
        obj.admissionno=localStorage.getItem("curr_sess_admnenquiryno");
        obj.schoolid=localStorage.getItem("schoolid");
        this.fetchexistingadmissionphysicinfoparam=obj;
        this.$.fetchexistingadmissionphysicinfoajax.generateRequest();
      },
      fetchexistingadmissionphysicinfoResponse:function(e){
        // alert(JSON.stringify(e.detail.response.returnval));
        var arr=e.detail.response.returnval;
        if(arr=='no rows'){
            // alert('No match found!');
        }
        else
        {
        document.querySelector('admission-form').physicdetail=arr[0].physic_detail;
        document.querySelector('admission-form').physicstatus=arr[0].physic_status;    
        document.querySelector('admission-form').mentaldetail=arr[0].mental_detail;
        document.querySelector('admission-form').mentalstatus=arr[0].mental_status;
        document.querySelector('admission-form').illnessdetail=arr[0].illness_detail;
        document.querySelector('admission-form').illnessstatus=arr[0].illness_status;
        document.querySelector('admission-form').allergydetail=arr[0].allergy_detail;
        document.querySelector('admission-form').allergystatus=arr[0].allergy_status;
        document.querySelector('admission-form').chronicdetail=arr[0].chronic_detail;
        document.querySelector('admission-form').chronicstatus=arr[0].chronic_status;
      
        }
      },
       fetchexistingadmissionhistoryinfoService:function(){
        this.fetchexistingadmissionhistoryinfourl=sessionStorage.getItem("addrinfo")+"/fetchexistingadmissionhistoryinfo";
        var obj={"admissionno":"","schoolid":""}
        obj.admissionno=localStorage.getItem("curr_sess_admnenquiryno");
        obj.schoolid=localStorage.getItem("schoolid");
        this.fetchexistingadmissionhistoryinfoparam=obj;
        this.$.fetchexistingadmissionhistoryinfoajax.generateRequest();
      },
      fetchexistingadmissionhistoryinfoResponse:function(e){
        // alert(JSON.stringify(e.detail.response.returnval));
        var arr=e.detail.response.returnval;
        if(arr=='no rows'){
            // alert('No match found!');
        }
        else
        {
        document.querySelector('admission-form').prevschoolname=arr[0].school_name;
        document.querySelector('admission-form').selectedfromgrade=arr[0].from_grade; 
        document.querySelector('admission-form').FnSetFromGrade(arr[0].from_grade);  
        document.querySelector('admission-form').selectedtograde=arr[0].to_grade;
        document.querySelector('admission-form').FnSetToGrade(arr[0].to_grade);
        document.querySelector('admission-form').selectedboard=arr[0].board;
        document.querySelector('admission-form').FnSetBoard(arr[0].board);
        document.querySelector('admission-form').yearfrom=arr[0].from_year;
        document.querySelector('admission-form').yearto=arr[0].to_year;
        document.querySelector('admission-form').medium=arr[0].medium_of_ins;
        document.querySelector('admission-form').lastclassmark=arr[0].percentage;
        document.querySelector('admission-form').reasonforleaving=arr[0].reason;
        }
      },
      callInsertAdmissionService:function(enquiryno,enquiryname,applicationno,schoolname,enquiredyear,admissionyear,firstname,middlename,lastname,gradeselection,secondlanguage,thirdlanguage,dob,age,gender,flatno,bulidingname,street,city,town,state,pincode,height,weight,FnBlood,relegions,relegion,nationality,mothertongue,siblingname,siblingclass,prevschoolname,fromgrade,tograde,FnBo,yearfrom,yearto,medium,lastclassmark,reasonforleaving,handler,physicdetail,physicstatus,mentaldetail,mentalstatus,illnessdetail,illnessstatus,allergydetail,allergystatus,chronicdetail,chronicstatus,acheivehandler,fathername,mothername,fatherqualification,motherqualification,fatheroccupation,motheroccupation,fatherincome,motherincome,fathertelno,mothertelno,fathermobile,mothermobile,fatheremail,motheremail,fatherdob,motherdob,pflatno,pbuildingname,pstreet,pdistrict,ptown,pstate,ppincode,guardianname1,guardianname2,relationship1,relationship2,gflatno,gbuildingname,gstreet,gcity,gtown,gstate,gpincode,gresidentialcontact,gofficecontact,gmobileno,gfax,admissiontransport,admissioncanteen,field1,year1,event1,prizedetail1,field2,year2,event2,prizedetail2,field3,year3,event3,prizedetail3){

        this.studentphysicalurl=sessionStorage.getItem("addrinfo")+"/studentphysical_service";
        
        var obj={"enquiryno":"","applicationno":"","schoolid":"","schoolname":"","admissionyear":"","firstname":"","middlename":"","lastname":"","studentname":"","gradeselection":"","admissiondob":"","admissiongender":"","admissiondisabled":"","createdby":"","physicdetail":"","physicstatus":"","mentaldetail":"","mentalstatus":"","illnessdetail":"","illnessstatus":"","allergydetail":"","allergystatus":"","chronicdetail":"","chronicstatus":""}
        obj.enquiryno=enquiryno;
        obj.applicationno=applicationno;
        obj.schoolid=localStorage.getItem("schoolid");
        obj.academicyear=admissionyear;
        obj.firstname=firstname;
        obj.middlename=middlename;
        obj.lastname=lastname;
        obj.studentname=firstname+' '+middlename+' '+lastname;
        obj.gradeselection=gradeselection;
        obj.physicdetail=physicdetail;
        obj.physicstatus=physicstatus;
        obj.mentaldetail=mentaldetail;
        obj.mentalstatus=mentalstatus;
        obj.illnessdetail=illnessdetail;
        obj.illnessstatus=illnessstatus;
        obj.allergydetail=allergydetail;
        obj.allergystatus=allergystatus;
        obj.chronicdetail=chronicdetail;
        obj.chronicstatus=chronicstatus;
        obj.createdby=localStorage.getItem("employeeid");  
        this.studentphysicalparam=obj; 
        // alert(handler);
        if(handler=="yes")
        this.$.studentphysicalajax.generateRequest();
        
        this.studentfulldetailsurl=sessionStorage.getItem("addrinfo")+"/studentfulldetails_service";
          
           var obj={"enquiryno":"","applicationno":"","schoolid":"","schoolname":"","admissionyear":"","firstname":"","middlename":"","lastname":"","studentname":"","gradeselection":"","admissiondob":"","admissiongender":"","admissioncanteen":"","admissiontransport":"","createdby":"","fathername":"","mothername":"","flatno":"","bulidingname":"","street":"","town":"","city":"","state":"","pincode":"","height":"","weight":"","nationality":"","mothertongue":"","siblingname":"","siblingclass":"","fatherdob":"","motherdob":"","fatherqualification":"","motherqualification":"","fatheroccupation":"","motheroccupation":"","fatherincome":"","motherincome":"","fathertelno":"","mothertelno":"","fathermobile":"","mothermobile":"","fatheremail":"","motheremail":"","ptown":"","pdistrict":"","pstate":"","ppincode":"","relationship1":"","guardianname1":"","relationship2":"","guardianname2":"","guardianname":"","gbuildingname":"","gstreet":"","gtown":"","gcity":"","gstate":"","gpincode":"","gresidentialcontact":"","gofficecontact":"","gmobileno":"","gfax":"","FnBlood":""}
        obj.enquiryno=enquiryno;
        obj.applicationno=applicationno;
        obj.schoolid=localStorage.getItem("schoolid");
        obj.schoolname=schoolname;
        obj.academicyear=admissionyear;
        obj.firstname=firstname;
        obj.middlename=middlename;
        obj.lastname=lastname;
        obj.studentname=firstname+' '+middlename+' '+lastname;
        obj.gradeselection=gradeselection;
        obj.secondlanguage=secondlanguage;
        obj.thirdlanguage=thirdlanguage;
        obj.admissiondob=dob;
        obj.admissiongender=gender;
        obj.flatno=flatno;
        obj.bulidingname=bulidingname;
        obj.street=street;
        obj.town=town;
        obj.city=city;
        obj.state=state;
        obj.pincode=pincode;
        obj.height=height;
        obj.weight=weight;
        obj.bloodgroup=FnBlood;
        obj.nationality=nationality;
        obj.mothertongue=mothertongue;
        obj.siblingname=siblingname;
        obj.siblingclass=siblingclass;
        obj.fatherdob=fatherdob;
        obj.motherdob=motherdob;
        obj.fathername=fathername;
        obj.mothername=mothername;
        obj.fatherqualification=fatherqualification;
        obj.motherqualification=motherqualification;
        obj.fatheroccupation=fatheroccupation;
        obj.motheroccupation=motheroccupation;
        obj.fatherincome=fatherincome;
        obj.motherincome=motherincome;
        obj.fathertelno=fathertelno;
        obj.mothertelno=mothertelno;
        obj.fathermobile=fathermobile;
        obj.mothermobile=mothermobile;
        obj.fatheremail=fatheremail;
        obj.motheremail=motheremail;
        obj.pflatno=pflatno;
        obj.pbuildingname=pbuildingname;
        obj.pstreet=pstreet;
        obj.ptown=ptown;
        obj.pdistrict=pdistrict;
        obj.pstate=pstate;
        obj.ppincode=ppincode;
        obj.relationship1=relationship1;
        obj.guardianname1=guardianname1;
        obj.relationship2=relationship2;
        obj.guardianname2=guardianname2;
        obj.gflatno=gflatno;
        obj.gbuildingname=gbuildingname;
        obj.gstreet=gstreet;
        obj.gtown=gtown;
        obj.gcity=gcity;
        obj.gstate=gstate;
        obj.gpincode=gpincode;
        obj.gresidentialcontact=gresidentialcontact;
        obj.gofficecontact=gofficecontact;
        obj.gmobileno=gmobileno;
        obj.religion=relegion;
        obj.caste=relegions;
        obj.createdby=localStorage.getItem("employeeid"); 
        this.studentfulldetailsparam=obj;
        this.$.studentfulldetailsajax.generateRequest();

       this.studentcocurricularurl=sessionStorage.getItem("addrinfo")+"/studentcocurricular_service";
        {
        var obj={"enquiryno":"","applicationno":"","schoolid":"","schoolname":"","admissionyear":"","firstname":"","middlename":"","lastname":"","studentname":"","gradeselection":"","createdby":"","sno1":"","field1":"","year1":"","event1":"","prizedetail1":"","sno2":"","field2":"","year2":"","event2":"","prizedetail2":"","sno3":"","field3":"","year3":"","event3":"","prizedetail3":""}
        obj.enquiryno=enquiryno;
        obj.applicationno=applicationno;
        obj.schoolid=localStorage.getItem("schoolid");
        obj.schoolname=schoolname;
        obj.academicyear=admissionyear;
        obj.firstname=firstname;
        obj.middlename=middlename;
        obj.lastname=lastname;
        obj.studentname=firstname+' '+middlename+' '+lastname;
        obj.gradeselection=gradeselection;
        // obj.sno1=sno1;
        obj.field1=field1;
        obj.year1=year1;
        obj.event1=event1;
        obj.prizedetail1=prizedetail1;
        // obj.sno2=sno2;
        obj.field2=field2;
        obj.year2=year2;
        obj.event2=event2;
        obj.prizedetail2=prizedetail2;
        // obj.sno3=sno3;
        obj.field3=field3;
        obj.year3=year3;
        obj.event3=event3;
        obj.prizedetail3=prizedetail3;
        obj.createdby=localStorage.getItem("employeeid"); 
        this.studentcocurricularparam=obj;
        // alert(acheivehandler);
        if(acheivehandler=="yes")
        this.$.studentcocurricularajax.generateRequest();
        }

        this.insertstudenthistoryurl=sessionStorage.getItem("addrinfo")+"/studenthistory_service";
        {
         var obj={"enquiryno":"","applicationno":"","schoolid":"","schoolname":"","admissionyear":"","firstname":"","middlename":"","lastname":"","studentname":"","gradeselection":"","admissiongender":"","createdby":"","prevschoolname":"","classfrom":"","classto":"","yearfrom":"","yearto":"","medium":"","lastclassmark":"","reasonforleaving":"","FnBo":""}
        obj.enquiryno=enquiryno;
        obj.applicationno=applicationno;
        obj.schoolid=localStorage.getItem("schoolid");
        obj.schoolname=schoolname;
        obj.admissionyear=admissionyear;
        obj.firstname=firstname;
        obj.middlename=middlename;
        obj.lastname=lastname;
        obj.studentname=firstname+' '+middlename+' '+lastname;
        obj.gradeselection=gradeselection;
        obj.createdby=localStorage.getItem("employeename");
        obj.prevschoolname=prevschoolname;
        obj.classfrom=fromgrade;
        obj.classto=tograde;
        obj.yearfrom=yearfrom;
        obj.yearto=yearto;
        obj.medium=medium;
        obj.lastclassmark=lastclassmark;
        obj.reasonforleaving=reasonforleaving;
        obj.board=FnBo;
        obj.createdby=localStorage.getItem("employeeid"); 
        this.insertstudenthistoryparam=obj;
        this.$.insertstudenthistoryajax.generateRequest();
     }

      this.insertadmissionurl=sessionStorage.getItem("addrinfo")+"/insertadmission";
        
        var obj={"enquiryno":"","applicationno":"","schoolid":"","schoolname":"","admissionyear":"","academicyear":"","firstname":"","middlename":"","lastname":"","studentname":"","gradeselection":"","admissiondob":"","admissiongender":"","fathername":"","mothername":"","admissiondisabled":"","admissioncanteen":"","admissiontransport":"","createdby":""}
        obj.enquiryno=enquiryno;
        obj.applicationno=applicationno;
        obj.schoolid=localStorage.getItem("schoolid");
        obj.schoolname=schoolname;
        obj.admissionyear=admissionyear;
        obj.academicyear=admissionyear;
        obj.firstname=firstname;
        obj.middlename=middlename;
        obj.lastname=lastname;
        obj.studentname=firstname+' '+middlename+' '+lastname;
        obj.gradeselection=gradeselection;
        obj.admissiondob=dob;
        obj.admissiongender=gender;
        obj.fathername=fathername;
        obj.mothername=mothername;
        obj.admissiondisabled=handler;
        obj.acheivehandler=acheivehandler;
        obj.admissioncanteen=admissioncanteen;
        obj.admissiontransport=admissiontransport;
        obj.createdby=localStorage.getItem("employeeid");    
        this.insertadmissionparam=obj;
        this.$.insertadmissionajax.generateRequest();

},

studentphysicalResponse:function(e){
alert("physical"+e.detail.response.returnval);
},
studentfulldetailsResponse:function(e){
alert("fulldetail"+e.detail.response.returnval);
},
studentcocurricularResponse:function(e){
alert("cocurricular"+e.detail.response.returnval);
},
insertstudenthistoryResponse:function(e){
alert("history"+e.detail.response.returnval);
},

      insertadmissionResponse:function(e){
        alert("Enrollment No genererated!!!"+e.detail.response.returnval);
        if(e.detail.response.returnval!='admissionfail')
        // this.callfetchadmissioncountService();
        document.querySelector('enquiry-card').ready();
      },     
      callfetchfeesService:function(academicyear,admissionyear,grade){
        this.fetchfeesurl=sessionStorage.getItem("addrinfo")+"/fetchfees";
        var obj={"schoolid":"","academicyear":"","admissionyear":"","grade":""}        
        obj.admissionyear=admissionyear; 
        obj.academicyear=academicyear; 
        obj.grade=grade; 
        obj.schoolid=localStorage.getItem("schoolid");     
        this.fetchfeesparam=obj;       
        this.$.fetchfeesajax.generateRequest();
      },
      fetchfeesResponse:function(e){        
        var arr=e.detail.response.returnval;        
        if(arr.length>0){
            localStorage.setItem("curr_sess_feecode",arr[0].fee_code); 
            document.querySelector('fees-card').totalfees=arr[0].fees;
            // this.fetchfeesplitup();
        }           
      },
      fetchfeesplitup:function(academic_year,admission_year,grade){
        this.fetchfeesplitupurl=sessionStorage.getItem("addrinfo")+"/fetchfeesplitup";
        var obj={"schoolid":"","academicyear":"","admissionyear":"","grade":""}        
        obj.admissionyear=admission_year; 
        obj.academicyear=academic_year; 
        obj.grade=grade; 
        obj.schoolid=localStorage.getItem("schoolid");    
        this.fetchfeesplitupparam=obj;       
        this.$.fetchfeesplitupajax.generateRequest();
      },
      fetchfeesplitupResponse:function(e){
        var arr=e.detail.response.returnval; 
        for(var i=0;i<arr.length;i++){

        }  
        document.querySelector('fees-card').feearr=arr; 
        document.querySelector('fees-card').FnHiddenPayment(); 
        // alert(JSON.stringify(arr));             
        // document.querySelector('fees-card').fees=arr[0].total_fee;
        // localStorage.setItem("curr_sess_fee",arr[0].total_fee);
        // this.callfetchnoofinstallmentService();    
      },
      callfetchnoofinstallmentService:function(){
        this.fetchnoofinstallmenturl=sessionStorage.getItem("addrinfo")+"/fetchnoofinstallment";
        var obj={"schoolid":"","feecode":"","feetype":""}         
        obj.feecode=localStorage.getItem("curr_sess_feecode");
        obj.schoolid=localStorage.getItem("schoolid");  
        obj.feetype=localStorage.getItem("curr_sess_feetype");       
        this.fetchnoofinstallmentparam=obj;       

        var arr=e.detail.response.returnval;
        if(localStorage.getItem("curr_sess_feetype")=="pros_fee"){
        document.querySelector('prospectousfee-card').academicyear=arr[0].academic_year;
        document.querySelector('prospectousfee-card').enquiredclass=arr[0].class;
        document.querySelector('prospectousfee-card').studentname=arr[0].enquiry_name;
        document.querySelector('prospectousfee-card').parentname=arr[0].father_name;
        document.querySelector('prospectousfee-card').dob=arr[0].dob;
        }
        localStorage.setItem("curr_sess_enquiryno",arr[0].enquiry_no);
        localStorage.setItem("curr_sess_academicyear",arr[0].academic_year);
        localStorage.setItem("curr_sess_grade",arr[0].class);
        localStorage.setItem("curr_sess_studentname",arr[0].enquiry_name);
        this.academicyear=(arr[0].academic_year).substring(3);
        this.admissionyear=(arr[0].academic_year).substring(3);
        this.grade=arr[0].class;
        this.callfetchfeesService();
        this.fetchfeesplitup();
        this.callfetchnoofinstallmentService();
      },
      callSearchadmnenquiryService:function(enquiryno){
        this.searchadmnenquiryurl=sessionStorage.getItem("addrinfo")+"/searchadmnenquiry";
        var obj={"enquiryno":"","schoolid":""}
        obj.enquiryno=enquiryno;
        obj.schoolid=localStorage.getItem("schoolid");
        this.searchadmnenquiryparam=obj;
        this.$.searchadmnenquiryajax.generateRequest();
      },
      searchadmnenquiryResponse:function(e){
        var arr=e.detail.response.returnval;
        // alert(JSON.stringify(arr));
        if(localStorage.getItem("curr_sess_feetype")=="reg_fee"){
        document.querySelector('registerationfee-card').admissionno=arr[0].admission_no;
        document.querySelector('registerationfee-card').academicyear=arr[0].academic_year;
        document.querySelector('registerationfee-card').enquiredclass=arr[0].class_for_admission;
        document.querySelector('registerationfee-card').studentname=arr[0].student_name;
        document.querySelector('registerationfee-card').parentname=arr[0].father_name;
        document.querySelector('registerationfee-card').dob=arr[0].dob;
        }
        if(localStorage.getItem("curr_sess_feetype")=="ann_fee"){
        alert(document.querySelector('annualfee-card').admissionno);
        document.querySelector('annualfee-card').admissionno=arr[0].admission_no;
        document.querySelector('annualfee-card').academicyear=arr[0].academic_year;
        document.querySelector('annualfee-card').enquiredclass=arr[0].class_for_admission;
        document.querySelector('annualfee-card').studentname=arr[0].student_name;
        document.querySelector('annualfee-card').parentname=arr[0].father_name;
        document.querySelector('annualfee-card').dob=arr[0].dob;
        }
        localStorage.setItem("curr_sess_enquiryno",arr[0].enquiry_no);
        localStorage.setItem("curr_sess_admissionno",arr[0].admission_no);
        localStorage.setItem("curr_sess_academicyear",arr[0].academic_year);
        localStorage.setItem("curr_sess_grade",arr[0].class_for_admission);
        localStorage.setItem("curr_sess_studentname",arr[0].student_name);
        this.academicyear=(arr[0].academic_year).substring(3);
        this.admissionyear=(arr[0].admission_year).substring(3);
        this.grade=arr[0].class_for_admission;
        this.callfetchfeesService();
        this.fetchfeesplitup();
        this.callfetchnoofinstallmentService();
      },
     searchfeeadmissionService:function(admissionno){
        this.searchfeeadmissionurl=sessionStorage.getItem("addrinfo")+"/searchfeeadmission";
        // localStorage.setItem("curr_sess_insertflag",2);
        var obj={"admissionno":"","schoolid":""};
        obj.admissionno=admissionno;
        obj.schoolid=localStorage.getItem("schoolid");
        this.searchfeeadmissionparam=obj;
        this.$.searchfeeadmissionajax.generateRequest();
     },
      searchfeeadmissionResponse:function(e){
        var admnarr=e.detail.response.returnval;
        var arr=[];
        var obj={"enquiry_no":"","enquiry_name":""};
        obj.enquiry_no=admnarr[0].admission_no; 
        obj.enquiry_name=admnarr[0].student_name;  
        arr.push(obj); 
        document.querySelector('fees-card').enquiryarr=arr;
      },
      searchfeeadmissioninfoService:function(admissionno){
        this.searchfeeadmissioninfourl=sessionStorage.getItem("addrinfo")+"/fetchexistingadmissioninfo";
        var obj={"admissionno":"","schoolid":""};
        obj.admissionno=admissionno;
        obj.schoolid=localStorage.getItem("schoolid");
        this.searchfeeadmissioninfoparam=obj;
        this.$.searchfeeadmissioninfoajax.generateRequest();
     },
     searchfeeadmissioninfoResponse:function(e){
        var arr=e.detail.response.returnval;
        if(arr.length>0){
        document.querySelector('fees-card').acyear=arr[0].academic_year;
        document.querySelector('fees-card').academicyear=arr[0].admission_year;
        document.querySelector('fees-card').enquiredclass=arr[0].class_for_admission;
        document.querySelector('fees-card').studentname=arr[0].student_name;
        document.querySelector('fees-card').parentname=arr[0].father_name;
        document.querySelector('fees-card').dob=arr[0].dob;
        localStorage.setItem("curr_sess_academicyear",arr[0].academic_year);
        localStorage.setItem("curr_sess_admissionyear",arr[0].admission_year);
        localStorage.setItem("curr_sess_grade",arr[0].class_for_admission);
        localStorage.setItem("curr_sess_studentname",arr[0].student_name);
        this.callfetchfeesService(arr[0].academic_year,arr[0].admission_year,arr[0].class_for_admission);
        this.fetchfeesplitup(arr[0].academic_year,arr[0].admission_year,arr[0].class_for_admission);
        }
     }
    });
  })();
  </script>
</dom-module>
