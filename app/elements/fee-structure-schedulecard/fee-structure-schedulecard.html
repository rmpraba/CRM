
<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="fee-structure-schedulecard">
  <template>
     
    <div class="row enquiry-form">
      <div class="list-group col-sm-12 panel-body form-category">
        <div class="col-sm-6 enquiry-input">
            <paper-input label="School Name" value="{{schoolname}}"></paper-input>
        </div>
        <div class="col-sm-4 enquiry-input">
          <paper-dropdown-menu label="Grade" >
            <paper-menu id="structuregrade" class="dropdown-content" required on-iron-select="FnSelectGrade" valueattr="value" >
              <template  is="dom-repeat" items="{{gradearr}}" as="item">
              <paper-item>{{item.grade_name}}</paper-item>
              </template>
            </paper-menu>
          </paper-dropdown-menu>
        </div>
        
      </div>

      <div class="list-group col-sm-12 panel-body form-category">
        <div class="col-sm-4 enquiry-input">
          <paper-dropdown-menu label="Select Discount Category" >
            <paper-menu id="schdiscount" class="dropdown-content" required on-iron-select="FnSelectDiscountType" valueattr="value" >
              <template  is="dom-repeat" items="{{discountarr}}" as="item">
              <paper-item value="{{item.discount_type_id}}">{{item.discount_type}}</paper-item>
              </template>
            </paper-menu>
          </paper-dropdown-menu>
        </div>
        <div class="col-sm-6 enquiry-input" hidden$="{{hideadmissiontype}}">
            <span class="col-sm-12"><h5>Spot Admission?</h5></span>
            <span><paper-checkbox class="col-sm-6" id="schspotyes" readonly class="checkbox" on-change="spotyesHandler">Yes</paper-checkbox></span>
            <span><paper-checkbox class="col-sm-6" id="schspotno" readonly class="checkbox" on-change="spotnoHandler">No</paper-checkbox></span>
        </div>
        <div class="col-sm-6 enquiry-input" hidden$="{{hideinstallmentpattern}}">
            <span class="col-sm-12"><h5>Installment pattern</h5></span>
            <span><paper-checkbox class="col-sm-6" id="schgeneral" readonly class="checkbox" on-change="generalHandler">General</paper-checkbox></span>
            <span><paper-checkbox class="col-sm-6" id="schinstallment" readonly class="checkbox" on-change="installmentHandler">Installment</paper-checkbox></span>
        </div>
      </div>

      <div class="list-group col-sm-12 panel-body form-category">

        <div class="col-sm-4">
          <paper-dropdown-menu label="Academic Year" attr-for-selected="value">
            <paper-menu id="structureacademicyear" class="dropdown-content" required on-iron-select="FnSelectAcademicYear" valueattr="value" >
              <template  is="dom-repeat" items="{{academicarr}}" as="item">
              <paper-item>{{item.academic_year}}</paper-item>
              </template>
            </paper-menu>
          </paper-dropdown-menu>
        </div>

        <div class="col-sm-4 enquiry-input">
          <paper-dropdown-menu label="Admission Year" attr-for-selected="value">
            <paper-menu id="structureadmissionyear" class="dropdown-content" required on-iron-select="FnSelectAdmissionYear" valueattr="value" >
              <template  is="dom-repeat" items="{{admissionarr}}" as="item">
              <paper-item>{{item.admission_year}}</paper-item>
              </template>
            </paper-menu>
          </paper-dropdown-menu>
        </div>

        <div class="col-sm-4">
          <paper-dropdown-menu label="No Of Installment" attr-for-selected="value">
            <paper-menu id="structureinstallment" class="dropdown-content" required on-iron-select="FnSelectInsatllmentNo" valueattr="value" >
              <!-- <template  is="dom-repeat" items="{{academicarr}}" as="item"> -->
              <paper-item>1</paper-item>
              <paper-item>2</paper-item>
              <paper-item>3</paper-item>
              <paper-item>4</paper-item>
              <paper-item>5</paper-item>
              <paper-item>6</paper-item>
              <paper-item>7</paper-item>
              <paper-item>8</paper-item>
              <paper-item>9</paper-item>
              <paper-item>10</paper-item>
              <!-- </template> -->
            </paper-menu>
          </paper-dropdown-menu>
        </div>
        </div>

        <div class="list-group col-sm-12 panel-body form-category" hidden$="{{hidefeecomponentcard}}">
          <template  is="dom-repeat" items="{{installmentarr}}" as="item">
            <fee-component-card installment="{{item.val}}" no="{{item.no}}" actualamount="{{item.actualamount}}" discount="{{item.discount}}" payableamount="{{item.payableamount}}"></fee-component-card> 
          </template>       
        </div>

        <div class="list-group col-sm-12 panel-body form-category" hidden$="{{hideinstallmentfeecomponentcard}}">
          <template  is="dom-repeat" items="{{installmentarr}}" as="item">
            <installment-fee-component-card installment="{{item.val}}" no="{{item.no}}" actualamount="{{item.actualamount}}" discount="{{item.discount}}" payableamount="{{item.payableamount}}"></installment-fee-component-card> 
          </template>       
        </div>

        <div class="col-md-12 form-button">
          <paper-button class="btn btn-primary" on-click="FnSubmit">Submit</paper-button>          
          <paper-button hidden$="{{hidefeecomponent}}" class="btn btn-primary" on-click="FnCancel">Cancel</paper-button>
        </div>
      </div>

      <schedule-service id="schedulefee"></schedule-service>
  </template>
  <script>
  (function() {
    'use strict';
    var grade,admissionyear,academicyear,noofinstallment,feetype,discountcode,discounttype,installmenttype,admissiontype;   
    var feecomponentarr=[];
    var installmentarr=[];
    var installmentsubarr=[];
    var installmentpattern="";

    Polymer({
      is: 'fee-structure-schedulecard',
      ready:function(){
        this.schoolname=localStorage.getItem("schoolname");
        this.hidefeecomponentcard=true;
        this.hideadmissiontype=true;
        this.hideinstallmentpattern=true;
        this.hideinstallmentfeecomponentcard=true;
      },
      FnSelectGrade:function(e){
        grade=(e.target.selectedItem.textContent).trim();
        localStorage.setItem("curr_sess_grade",grade);
      },
      FnSelectAdmissionYear:function(e){
        admissionyear=(e.target.selectedItem.textContent).trim();
        localStorage.setItem("curr_sess_admissionyear",admissionyear);
      },
      FnSelectAcademicYear:function(e){
        academicyear=(e.target.selectedItem.textContent).trim();
        localStorage.setItem("curr_sess_academicyear",academicyear);
      },
      FnSelectInsatllmentNo:function(e){
        noofinstallment=(e.target.selectedItem.textContent).trim();  
        localStorage.setItem("curr_sess_noofinstallment",noofinstallment);
        if(grade==""||grade==null||admissionyear==""||admissionyear==null||academicyear==""||academicyear==null||noofinstallment==""||noofinstallment==null|admissiontype==""||admissiontype==null||discountcode==null||discountcode==""){
          alert("Please Select all the fields for generating schedule!!");
        }      
        else
        {
        this.$.schedulefee.fetchtotalinstallmentfeecode(discountcode,discounttype,admissiontype);
        var ins=[];
        noofinstallment=noofinstallment;
        for(var i=0;i<noofinstallment;i++)
        {
          var obj={"val":"","no":""};
          obj.no=i+1;
          obj.val="Installment"+(i+1);
          ins.push(obj);
        }        
        this.installmentarr=ins;
        if(installmentpattern=="2")
          this.hideinstallmentfeecomponentcard=false;
        else
          this.hidefeecomponentcard=false;
        }
      },
      FnMakeVisbleInstallmentCard:function(insno){
        var ins=[];
        noofinstallment=noofinstallment+insno;
        for(var i=0;i<noofinstallment;i++)
        {
          var obj={"val":"","no":""};
          obj.no=i+1;
          obj.val="Installment"+(i+1);
          ins.push(obj);
        }        
        this.installmentarr=ins;
        this.hidefeecomponentcard=false;
      },
      FnSubmit:function(){
        this.$.schedulefee.setInstallmentFeecomponent(this.schoolname,grade,admissionyear,academicyear,noofinstallment,discountcode,discounttype,installmentarr,installmentsubarr,admissiontype);
      },
      FnViewFeeComponent:function(){
        this.hidefeecomponent=false;
      },
      FnRefresh:function(){
        grade="";
        admissionyear="";
        academicyear="";
        feetype="";
        this.amount="";
        discounttype="";
        installmenttype="";
        admissiontype="";
        document.querySelector('#structuregrade').selected=-1;
        document.querySelector('#structureacademicyear').selected=-1;
        document.querySelector('#structureadmissionyear').selected=-1;
        document.querySelector('#structureinstallment').selected=-1;
      },
      FnCancel:function(){
        grade="";
        admissionyear="";
        academicyear="";
        feetype="";
        this.amount="";
        discounttype="";
        installmenttype="";
        discounttype="";
        admissiontype="";
        document.querySelector('#structuregrade').selected=-1;
        document.querySelector('#structureacademicyear').selected=-1;
        document.querySelector('#structureadmissionyear').selected=-1;
        document.querySelector('#structureinstallment').selected=-1;
      },
      FnSetFeeComponent:function(arr){
        feecomponentarr=[];
        for(var i=0;i<arr.length;i++){          
          feecomponentarr.push(arr[i]);
        }
      },
      FnSetInsatllment:function(insarr,inssubarr)
      {
        installmentarr=insarr;
        installmentsubarr=inssubarr;
        // alert(JSON.stringify(installmentarr));
        // alert(JSON.stringify(installmentsubarr));
      },
      FnSelectDiscountType:function(e){
        discountcode=(e.target.selectedItem.value).trim();
        discounttype=(e.target.selectedItem.textContent).trim();
        if(discountcode==2){
          this.hideadmissiontype=true;
          this.hideinstallmentpattern=false;
          admissiontype="0";
        }
        else{
          this.hideadmissiontype=false;
          this.hideinstallmentpattern=true;
        }
        localStorage.setItem("curr_sess_discounttypecode",discountcode);
        localStorage.setItem("curr_sess_discounttype",discounttype);
      },
      spotyesHandler:function(e){
        if(document.querySelector("#schspotyes").checked==true)
        {
         document.querySelector("#schspotno").checked=false;
         admissiontype="1";
         localStorage.setItem("curr_sess_admissiontype",admissiontype);
        }
      },
      spotnoHandler:function(e){
        document.querySelector("#schspotno").checked=true;
        {
         document.querySelector("#schspotyes").checked=false;
         admissiontype="0";
         localStorage.setItem("curr_sess_admissiontype",admissiontype);
        }
      },
      generalHandler:function(e){
        if(document.querySelector("#schgeneral").checked==true)
        {
         document.querySelector("#schinstallment").checked=false;
         installmentpattern="1";
         localStorage.setItem("curr_sess_installmentpattern",installmentpattern);
        }
      },
      installmentHandler:function(e){
        if(document.querySelector("#schinstallment").checked==true)
        {
         document.querySelector("#schgeneral").checked=false;
         installmentpattern="2";
         localStorage.setItem("curr_sess_installmentpattern",installmentpattern);
        }
      }  
      });  
  })();
  </script>
</dom-module>
