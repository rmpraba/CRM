<!--
@license
Copyright (c) 2015 tde Polymer Project Autdors. All rights reserved.
tdis code may only be used under tde BSD style license found at http://polymer.gitdub.io/LICENSE.txt
tde complete set of autdors may be found at http://polymer.gitdub.io/AUtdORS.txt
tde complete set of contdibutors may be found at http://polymer.gitdub.io/CONtdIBUTORS.txt
Code distdibuted by Google as part of tde polymer project is also
subject to an additional IP rights grant found at http://polymer.gitdub.io/PATENTS.txt
-->

<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<link rel="import" href="..\followup-datepicker-card/followup-datepicker-card.html">
<dom-module id="followup-listitem-card">
  <template>
    <style>
      :host {
        display: block;
      }
      #dialog2{
            margin-left: -25%;
                top: 30%;
      }
      #dialog3{
            margin-left: -25%;
                top: 30%;
      }
      
    </style>
    <div>
    <table class="table table-stdiped" style="    margin-bottom: -2%;" >
        <tbody>
        <tr class="list-group col-sm-12 panel-body form-category" id="list">
        <td class="col-sm-2" style="text-align:center; padding-top: 5%;">
          {{sno}}
        </td>
          <td class="col-sm-3" style="text-align:center; padding-top: 4%;">
            <div class="col-sm-12">
              <div class="col-sm-6">
                <paper-checkbox id="callyes{{followupno}}" on-change="yescallstatusHandler" class="checkbox" checked={{yesbox}} disabled={{disableyes}}>Yes</paper-checkbox>
              </div>
              <div class="col-sm-6">
                <paper-checkbox id="callno{{followupno}}" on-change="nocallstatusHandler"  class="checkbox" checked={{nobox}}  disabled={{disableno}}>No</paper-checkbox>
              </div>
            </div>
          </td>
          <td class="col-sm-2" style="text-align:center; padding-top: 4%;">
            <paper-item>{{scheduledate}}</paper-item>
          </td>
          
          <td class="col-sm-3" style="text-align:center; ">
       
          <div class="col-sm-12">
          <!-- <followup-datepicker-card id="dates" showdate="{{nextdate}}"></followup-datepicker-card> -->
          <paper-input id="dates" label="Date" error-message="needs next followup date!" required value="{{nextdate}}"></paper-input>
          <div id="reschedule" style=" padding-top: 16%; padding-left: 33%;  margin-left: -28%;">
          <paper-button  class="buttons" on-click="Rescheduling" >Reschedule</paper-button></div>
          </div>
        
          
          </td>
            <!-- <div id="confidencelabel">{{confidencelvl}}</div> -->
          
          <td class="col-sm-3" style="text-align:center; padding-top: 6%;"><div id="viewdetail"><a href="">view details</a></div>
          <div id="notcompleted">Still not completed</div></td>
        </tr>
        </tbody>
        <div hidden>{{callstatus}}/{{confidencelvl}}/{{followupno}}/{{fid}}/{{nextdate}}</div>
      </table>
      </div>
       <paper-dialog id="dialog1" class="paper-date-picker-dialog">
        <paper-date-picker id="picker" date="{{date}}"></paper-date-picker>
        <div class="buttons">
          <paper-button raised on-click="close1">Cancel</paper-button>
          <paper-button raised on-click="FnDismissDialog1">OK</paper-button>
        </div>
      </paper-dialog>

      <paper-dialog id="dialog2" class="paper-date-picker-dialog">
      <div class="content">
      <div>Confidence Level : 
        <paper-dropdown-menu style="margin-left: 5%;" id="followdrop" disabled={{disabledrop}} label="Select Confidence Level">
              <paper-listbox id="confidencelevel" class="dropdown-content" on-iron-select="FnConfidenceLevel">
                <paper-item value=0>TBD</paper-item>
                <paper-item value=1>>90%</paper-item>
                <paper-item value=2>>75%</paper-item>
                <paper-item value=3>>50%</paper-item>
                <paper-item value=4><50%</paper-item>
                <paper-item value=5><35%</paper-item>
                <paper-item value=6><10%</paper-item>
              </paper-listbox>
            </paper-dropdown-menu>
</div>
            <iron-autogrow-textarea id="followbox1" placeholder="Please type your comments here..." error-message="needs comments!" required value="{{value}}"></iron-autogrow-textarea>
             <div>
              <followup-datepicker-card showdate="{{nextdate}}"></followup-datepicker-card>
            </div>
      </div>
        <div class="buttons">
          <paper-button id="followdisk2" style="background-color: silver;" class="btn glyphicon glyphicon-floppy-disk" raised on-click="FollowUp">Save</paper-button>
          <paper-button raised style="background-color: silver;" on-click="FnDismissDialog2">Cancel</paper-button>
        </div>
      </paper-dialog>

      <paper-dialog id="dialog3" class="paper-date-picker-dialog">
      <div class="content">
      <div>Current call status : 
        <paper-dropdown-menu style="margin-left: 5%;" id="followdrop2" disabled={{disabledrop2}} label="Select call status">
              <paper-listbox id="callstatusdrop" class="dropdown-content" on-iron-select="Fncallstatusdrop">
                  <paper-item>Didnâ€™t pick up</paper-item>
                  <paper-item>Switch off</paper-item>
                  <paper-item>Wrong number</paper-item>
                  <paper-item>Busy</paper-item>
                  <paper-item>Not reachable</paper-item>
                  <paper-item>Not available</paper-item>
                </paper-listbox>
            </paper-dropdown-menu>
</div>

            <iron-autogrow-textarea id="followbox2" placeholder="Please type your comments here..." error-message="needs comments!" required bind-value="{{value}}"></iron-autogrow-textarea>
            <div>
              <followup-datepicker-card showdate="{{nextdate}}"></followup-datepicker-card>
            </div>
      </div>
        <div class="buttons">
          <paper-button id="followdisk3" style="background-color: silver;" class="btn glyphicon glyphicon-floppy-disk" raised on-click="FollowUp">Save</paper-button>
          <paper-button raised style="background-color: silver;" on-click="FnDismissDialog3">Cancel</paper-button>
        </div>
      </paper-dialog>
      
     
      <followup-service id="followupservice"></followup-service>
  </template>
  <script>
  (function() {
    'use stdict';
    var confidencelvl;
    var callstatus;
    var vnextdate;
    var currentdate;
    var callpickstatus;

    Polymer({
      is: 'followup-listitem-card',

      ready:function(){
        confidencelvl="TBD";
        currentdate=sessionStorage.getItem("todaydate");
        
        //this.$.confidencelabel.hidden=false;
        //this.$.followdrop.hidden=false;
        
        /*if(this.comments!=""||this.comments!=null){
          this.$.followupcmnts.hidden=true;
            //this.disableyes=true;
            //this.disableno=true;
            //this.disabledrop=true;
            this.disabledate=true;
        }
        else{
          this.$.followbox.hidden=true;
        }*/

        //vnextdate=this.nextdate;
        
        if(this.callstatus=="Yes"){
              this.yesbox=true;
              this.$.notcompleted.hidden=true;
            this.$.viewdetail.hidden=false;
        }
        else if(this.callstatus=="No"){
              this.nobox=true;
              this.$.notcompleted.hidden=true;
            this.$.viewdetail.hidden=false;
        }
        else{
            this.$.notcompleted.hidden=false;
            this.$.viewdetail.hidden=true;
        }
        if(this.confidencelvl==''||this.confidencelvl==null){
          this.$.confidencelevel.selected=0;
          //this.$.confidencelabel.hidden=true;
        }
        else{
          //this.$.followdrop.hidden=true;
              if(this.confidencelvl=='>90%'){
                this.$.confidencelevel.selected=1;
              }
              else if(this.confidencelvl=='>75%'){
                this.$.confidencelevel.selected=2;
              }
              else if(this.confidencelvl=='>50%'){
                this.$.confidencelevel.selected=3;
              }
              else if(this.confidencelvl=='<50%'){
                this.$.confidencelevel.selected=4;
              }
              else if(this.confidencelvl=='<35%'){
                this.$.confidencelevel.selected=5;
              }
              else if(this.confidencelvl=='<10%'){
                this.$.confidencelevel.selected=6;
              }
        }
        

         if((this.nextdate=='NaN-NaN-NaN')||(this.nextdate=='0000-00-00 00:00:00')){
           this.$.dates.hidden=true;
          this.$.reschedule.hidden=false;
        }
        else{
           this.$.dates.hidden=false;
          this.$.reschedule.hidden=true; 
        }

      },
      yescallstatusHandler:function(){
        if(document.getElementById('callyes'+this.followupno).checked==true){
          callstatus="Yes";
          //alert(callstatus);
          //this.$.followdisk.disabled=false;
          document.getElementById('callno'+this.followupno).checked=false;
          this.$.dialog2.open();
        }
        else{
          callstatus=null;
          //this.$.followdisk.disabled=true; 
        }
      },
      nocallstatusHandler:function(){
          if(document.getElementById('callno'+this.followupno).checked==true){
          callstatus="No";
          //alert(callstatus);
          //this.$.followdisk.disabled=false;
          document.getElementById('callyes'+this.followupno).checked=false;
          this.$.dialog3.open();
        }
        else{
          callstatus=null;
          //this.$.followdisk.disabled=true; 
        }
      },
      FnConfidenceLevel:function(e){
        confidencelvl=(e.target.selectedItem.textContent).trim();
      },
      dateclear:function(){
        alert('You are allowed to select only future date..!');
        vnextdate=null;
      },
      getdate:function(nextdatez){
        vnextdate=nextdatez;
        this.nextdate=nextdatez;
        //alert(vnextdate);
      },
      FollowUp:function(){
        if(this.value==""||vnextdate==null||confidencelvl==null){
          //this.$.dates.validate();
          this.$.followbox1.validate();
          this.$.followbox2.validate();
          if(confidencelvl==null){
            alert('Please select the Confidence level of this followup');
          }
          else if(vnextdate==null){
            alert('Please select the proper date for next followup');
          }
        }
        else{
          alert(this.fid+this.scheduledate+this.followupno+currentdate+vnextdate+this.value+callstatus+confidencelvl);
            this.$.followupservice.updatefolowup(this.fid,this.scheduledate,this.followupno,currentdate,vnextdate,this.value,callstatus,confidencelvl);  
            this.$.dialog2.close();
             this.$.dialog3.close();
             document.getElementById('followbox1').value="";
             document.getElementById('followbox2').value="";
             this.value="";
        }
        
      },
      
      dialogfollowup:function(){
        document.getElementById('dialog1').open();
      },
      close1:function(){
        document.getElementById('dialog1').close();
      },
      FnDismissDialog1:function(){
        var pickdate=moment(this.$.picker.date).format('L');
        var dt=new Date(pickdate);
       var datesx=dt.getDate()+'/'+(dt.getMonth()+1)+'/'+dt.getFullYear();
       this.nextdate=datesx;
       
       //document.getElementById('fndates'+this.followupno).value=datesx;
      // document.querySelector('followup-listitem-card').setdate(datesx);
     /*if(this.followupdate5==datesx){  
          alert('Date Repeated! Please select difference date..');
      }
      else {
          this.followupdate4 = dt.getDate()+'/'+(dt.getMonth()+1)+'/'+dt.getFullYear();
        }*/
        document.getElementById('dialog1').close();
      },
      Rescheduling:function(){
        this.$.followupservice.Fnreschedule(this.confidencelvl,this.fid);
      },
      
      FnDismissDialog2:function(){
         document.getElementById('dialog2').close();
          document.querySelector('#confidencelevel').selected=-1;
          document.getElementById('followbox1').value="";
          this.value="";
          document.getElementById('callyes'+this.followupno).checked=false;
          this.$.dialog2.close();
      },
       Fncallstatusdrop:function(e){
        callpickstatus=(e.target.selectedItem.textContent).trim();
        alert(callpickstatus);
        //document.getElementById('followbox2').value=(e.target.selectedItem.textContent).trim();
        this.value=(e.target.selectedItem.textContent).trim();
      },
      FnDismissDialog3:function(){
        document.querySelector('#callstatusdrop').selected=-1;
        document.getElementById('followbox2').value="";
        this.value="";
         document.getElementById('callno'+this.followupno).checked=false;
          this.$.dialog3.close();
      }
    });
  })();
  </script>
</dom-module>
